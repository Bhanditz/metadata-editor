<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>jena-wrapper.scala</title>
  <link rel="stylesheet" href="http://jashkenas.github.com/docco/resources/docco.css">
</head>
<body>
<div id='container'>
  <div id="background"></div>
  <div id="jump_to">
    Jump To &hellip;
    <div id="jump_wrapper">
      <div id="jump_page">
        <a class="source" href="jena-wrapper.html">jena-wrapper.scala</a>
        <a class="source" href="metadata-editor.html">metadata-editor.scala</a>
        </div>
    </div>
  </div>
  <table cellspacing=0 cellpadding=0>
  <thead>
    <tr>
      <th class=docs><h1>jena-wrapper.scala</h1></th>
      <th class=code></th>
    </tr>
  </thead>
  <tbody>
    <tr id='section-1'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-1">#</a>
        </div>
        <p> This wrapper mitigates some of the brokenness of the intersection of Jena&rsquo;s worldview, the reality of RDF, and Java&rsquo;s laughable type system.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre><span class="k">package</span> <span class="nn">org.cellml.metadata_editor</span>

<span class="k">import</span> <span class="nn">com.hp.hpl.jena.rdf.arp._</span>
<span class="k">import</span> <span class="nn">com.hp.hpl.jena.rdf.model.</span><span class="o">{</span><span class="nc">Model</span><span class="o">,</span> <span class="nc">Alt</span><span class="o">,</span> <span class="nc">Bag</span><span class="o">,</span> <span class="nc">Seq</span> <span class="k">=&gt;</span> <span class="nc">JSeq</span><span class="o">,</span> <span class="nc">Container</span> <span class="k">=&gt;</span> <span class="nc">JContainer</span><span class="o">,</span> <span class="nc">RDFNode</span><span class="o">,</span> <span class="nc">ModelFactory</span><span class="o">,</span> <span class="nc">Property</span><span class="o">,</span> <span class="nc">Statement</span><span class="o">,</span> <span class="nc">Resource</span><span class="o">}</span>


<span class="k">object</span> <span class="nc">JenaWrapper</span> <span class="o">{</span>
  <span class="k">trait</span> <span class="nc">stringable</span> <span class="o">{</span> <span class="k">def</span> <span class="n">getString</span><span class="o">()</span><span class="k">:</span> <span class="kt">String</span> <span class="o">}</span>
  <span class="k">trait</span> <span class="nc">propertyable</span> <span class="k">extends</span> <span class="n">stringable</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">getProperty</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Property</span><span class="o">)</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">propertyable</span><span class="o">]</span>
    <span class="k">def</span> <span class="n">addProperty</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Property</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> 
    <span class="k">def</span> <span class="n">addProperty</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Property</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">RDFNode</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span>
    <span class="k">def</span> <span class="n">hasProperty</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Property</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span>
    <span class="k">def</span> <span class="n">removeAll</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Property</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span>
    <span class="k">def</span> <span class="n">getModel</span><span class="o">()</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Model</span><span class="o">]</span>
    <span class="k">def</span> <span class="n">canAs</span><span class="o">[</span><span class="kt">A</span> <span class="k">&lt;:</span> <span class="kt">RDFNode</span><span class="o">](</span><span class="n">clazz</span><span class="k">:</span> <span class="kt">Class</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">Boolean</span>
    <span class="k">def</span> <span class="n">as</span><span class="o">[</span><span class="kt">A</span> <span class="k">&lt;:</span> <span class="kt">RDFNode</span><span class="o">](</span><span class="n">clazz</span><span class="k">:</span> <span class="kt">Class</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
  <span class="o">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-2'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-2">#</a>
        </div>
        <p> Wrap both statements and resources into a uniform interface, which maps
 both Resources and Literals into a trait &lsquo;propertyable&rsquo;.</p>
      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">implicit</span> <span class="k">def</span> <span class="n">stmt2saferes</span><span class="o">(</span><span class="n">stmt</span><span class="k">:</span> <span class="kt">Statement</span><span class="o">)</span><span class="k">:</span> <span class="kt">propertyable</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">getObject</span><span class="o">().</span><span class="n">isLiteral</span><span class="o">())</span>
      <span class="k">new</span> <span class="n">litResWrapper</span><span class="o">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">getObject</span><span class="o">())</span>
    <span class="k">else</span>
      <span class="k">new</span> <span class="n">safeResWrapper</span><span class="o">(</span><span class="n">stmt</span><span class="o">.</span><span class="n">getResource</span><span class="o">())</span>
  <span class="o">}</span>
  <span class="k">implicit</span> <span class="k">def</span> <span class="n">res2prop</span><span class="o">(</span><span class="n">res</span><span class="k">:</span> <span class="kt">Resource</span><span class="o">)</span><span class="k">:</span> <span class="kt">propertyable</span> <span class="o">=</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">res</span><span class="o">.</span><span class="n">isLiteral</span><span class="o">())</span>
      <span class="k">new</span> <span class="n">litResWrapper</span><span class="o">(</span><span class="n">res</span><span class="o">)</span>
    <span class="k">else</span>
      <span class="k">new</span> <span class="n">safeResWrapper</span><span class="o">(</span><span class="n">res</span><span class="o">)</span>
  <span class="o">}</span>
  <span class="k">class</span> <span class="nc">litResWrapper</span><span class="o">(</span><span class="n">proxy</span><span class="k">:</span> <span class="kt">RDFNode</span><span class="o">)</span> <span class="k">extends</span> <span class="n">propertyable</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">getProperty</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Property</span><span class="o">)</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">propertyable</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span>
    <span class="k">def</span> <span class="n">addProperty</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Property</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="nc">Unit</span>
    <span class="k">def</span> <span class="n">addProperty</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Property</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">RDFNode</span><span class="o">)</span> <span class="k">=</span> <span class="nc">Unit</span>
    <span class="k">def</span> <span class="n">hasProperty</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Property</span><span class="o">)</span> <span class="k">=</span> <span class="kc">false</span>
    <span class="k">def</span> <span class="n">removeAll</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Property</span><span class="o">)</span> <span class="k">=</span> <span class="nc">Unit</span>
    <span class="k">def</span> <span class="n">getModel</span><span class="o">()</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Model</span><span class="o">]</span> <span class="k">=</span> <span class="nc">None</span> 
    <span class="k">def</span> <span class="n">canAs</span><span class="o">[</span><span class="kt">A</span> <span class="k">&lt;:</span> <span class="kt">RDFNode</span><span class="o">](</span><span class="n">clazz</span><span class="k">:</span> <span class="kt">Class</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">canAs</span><span class="o">(</span><span class="n">clazz</span><span class="o">)</span>
    <span class="k">def</span> <span class="n">as</span><span class="o">[</span><span class="kt">A</span> <span class="k">&lt;:</span> <span class="kt">RDFNode</span><span class="o">](</span><span class="n">clazz</span><span class="k">:</span> <span class="kt">Class</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
      <span class="k">if</span><span class="o">(</span><span class="n">canAs</span><span class="o">(</span><span class="n">clazz</span><span class="o">))</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
          <span class="nc">Some</span><span class="o">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">as</span><span class="o">(</span><span class="n">clazz</span><span class="o">))</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">{</span>
          <span class="k">case</span> <span class="n">e</span> <span class="k">=&gt;</span> <span class="nc">None</span>
        <span class="o">}</span>
      <span class="o">}</span>
      <span class="k">else</span>
        <span class="nc">None</span>
    <span class="o">}</span>
    <span class="k">def</span> <span class="n">getString</span><span class="o">()</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">toString</span><span class="o">()</span>
  <span class="o">}</span>
  <span class="k">class</span> <span class="nc">safeResWrapper</span><span class="o">(</span><span class="n">proxy</span><span class="k">:</span> <span class="kt">Resource</span><span class="o">)</span> <span class="k">extends</span> <span class="n">propertyable</span> <span class="o">{</span>
    <span class="k">def</span> <span class="n">getProperty</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Property</span><span class="o">)</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">propertyable</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
      <span class="k">if</span> <span class="o">(!</span><span class="n">proxy</span><span class="o">.</span><span class="n">hasProperty</span><span class="o">(</span><span class="n">a</span><span class="o">))</span>
        <span class="nc">None</span>
      <span class="k">else</span>
        <span class="nc">Some</span><span class="o">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">getProperty</span><span class="o">(</span><span class="n">a</span><span class="o">))</span>
    <span class="o">}</span>
    <span class="k">def</span> <span class="n">addProperty</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Property</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">addProperty</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span>
    <span class="k">def</span> <span class="n">addProperty</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Property</span><span class="o">,</span> <span class="n">b</span><span class="k">:</span> <span class="kt">RDFNode</span><span class="o">)</span> <span class="k">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">addProperty</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">)</span>
    <span class="k">def</span> <span class="n">hasProperty</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Property</span><span class="o">)</span> <span class="k">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">hasProperty</span><span class="o">(</span><span class="n">a</span><span class="o">)</span>
    <span class="k">def</span> <span class="n">removeAll</span><span class="o">(</span><span class="n">a</span><span class="k">:</span> <span class="kt">Property</span><span class="o">)</span> <span class="k">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">removeAll</span><span class="o">(</span><span class="n">a</span><span class="o">)</span>
    <span class="k">def</span> <span class="n">getModel</span><span class="o">()</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">Model</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Some</span><span class="o">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">getModel</span><span class="o">())</span>
    <span class="k">def</span> <span class="n">canAs</span><span class="o">[</span><span class="kt">A</span> <span class="k">&lt;:</span> <span class="kt">RDFNode</span><span class="o">](</span><span class="n">clazz</span><span class="k">:</span> <span class="kt">Class</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">canAs</span><span class="o">(</span><span class="n">clazz</span><span class="o">)</span>
    <span class="k">def</span> <span class="n">as</span><span class="o">[</span><span class="kt">A</span> <span class="k">&lt;:</span> <span class="kt">RDFNode</span><span class="o">](</span><span class="n">clazz</span><span class="k">:</span> <span class="kt">Class</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
      <span class="k">if</span><span class="o">(</span><span class="n">canAs</span><span class="o">(</span><span class="n">clazz</span><span class="o">))</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
          <span class="nc">Some</span><span class="o">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">as</span><span class="o">(</span><span class="n">clazz</span><span class="o">))</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">{</span>
          <span class="k">case</span> <span class="n">e</span> <span class="k">=&gt;</span> <span class="nc">None</span>
        <span class="o">}</span>
      <span class="o">}</span>
      <span class="k">else</span>
        <span class="nc">None</span>
    <span class="o">}</span>
    <span class="k">def</span> <span class="n">getString</span><span class="o">()</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">toString</span><span class="o">()</span>
  <span class="o">}</span></pre></div>
      </td>
    </tr>
    <tr id='section-3'>
      <td class=docs>
        <div class="octowrap">
          <a class="octothorpe" href="#section-3">#</a>
        </div>
        <p> It makes more sense to access an RDF container using Scala&rsquo;s rich container
 stuff than using Jena&rsquo;s crippled interface. We implicitly convert where necessary; at
 this point the conversion is only useful for non-destructive operations, as
 we do not do any automatic alteration of the underlying RDF based on alteration to the
 implicitly generated object.</p>

      </td>
      <td class=code>
        <div class='highlight'><pre>  <span class="k">implicit</span> <span class="k">def</span> <span class="n">container2seq</span><span class="o">(</span><span class="n">thing</span><span class="k">:</span> <span class="kt">JContainer</span><span class="o">)</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">RDFNode</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
    <span class="k">var</span> <span class="n">f</span><span class="k">:</span> <span class="kt">Seq</span><span class="o">[</span><span class="kt">RDFNode</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Seq</span><span class="o">()</span>
    <span class="k">var</span> <span class="n">iter</span> <span class="k">=</span> <span class="n">thing</span><span class="o">.</span><span class="n">iterator</span>
    <span class="k">while</span><span class="o">(</span><span class="n">iter</span><span class="o">.</span><span class="n">hasNext</span><span class="o">)</span>
      <span class="n">f</span> <span class="k">=</span> <span class="n">f</span> <span class="o">:+</span> <span class="n">iter</span><span class="o">.</span><span class="n">next</span><span class="o">()</span>
    <span class="n">iter</span><span class="o">.</span><span class="n">close</span><span class="o">()</span>
    <span class="n">f</span>
  <span class="o">}</span>
<span class="o">}</span></pre></div>
      </td>
    </tr>
    </table>
</div>
</body>
